<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>rahsays Calculator</title>

<style>
:root{
  --bg:#000;
  --display:#fff;
  --btn:#1c1c1c;
  --btn-gray:#a5a5a5;
  --btn-orange:#ff9500;
  --radius:50%;
  --transition:120ms cubic-bezier(.4,0,.2,1);
}

*{
  box-sizing:border-box;
  margin:0;
  padding:0;
}

body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
  background:var(--bg);
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

.calculator{
  width:100%;
  max-width:420px;
  padding:20px;
}

.display{
  color:var(--display);
  font-size:64px;
  text-align:right;
  padding:20px 10px;
  min-height:90px;
  overflow-x:auto;
  white-space:nowrap;
}

.buttons{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:14px;
}

button{
  height:75px;
  border:none;
  border-radius:var(--radius);
  font-size:28px;
  background:var(--btn);
  color:white;
  cursor:pointer;
  transition:var(--transition);
}

button:active{
  transform:scale(0.9);
  filter:brightness(1.2);
}

.gray{
  background:var(--btn-gray);
  color:black;
}

.orange{
  background:var(--btn-orange);
}

.zero{
  grid-column:span 2;
  border-radius:40px;
  text-align:left;
  padding-left:30px;
}

/* Tablet scaling */
@media(min-width:768px){
  .calculator{
    max-width:500px;
  }
  button{
    height:85px;
    font-size:30px;
  }
}
</style>
</head>

<body>

<div class="calculator">
  <div class="display" id="display">0</div>

  <div class="buttons" id="buttons">
    <button class="gray" data-action="clear">AC</button>
    <button class="gray" data-action="sign">±</button>
    <button class="gray" data-action="percent">%</button>
    <button class="orange" data-operator="/">÷</button>

    <button data-number="7">7</button>
    <button data-number="8">8</button>
    <button data-number="9">9</button>
    <button class="orange" data-operator="*">×</button>

    <button data-number="4">4</button>
    <button data-number="5">5</button>
    <button data-number="6">6</button>
    <button class="orange" data-operator="-">−</button>

    <button data-number="1">1</button>
    <button data-number="2">2</button>
    <button data-number="3">3</button>
    <button class="orange" data-operator="+">+</button>

    <button class="zero" data-number="0">0</button>
    <button data-number=".">.</button>
    <button class="orange" data-action="equals">=</button>
  </div>
</div>

<script>
class Calculator {
  constructor(displayElement){
    this.displayElement = displayElement
    this.reset()
  }

  reset(){
    this.current = "0"
    this.previous = null
    this.operator = null
    this.shouldResetScreen = false
    this.updateDisplay()
  }

  updateDisplay(){
    this.displayElement.textContent = this.current
  }

  appendNumber(number){
    if(this.shouldResetScreen){
      this.current = number === "." ? "0." : number
      this.shouldResetScreen = false
    } else {
      if(number === "." && this.current.includes(".")) return
      this.current = this.current === "0" && number !== "." ? number : this.current + number
    }
    this.updateDisplay()
  }

  chooseOperator(operator){
    if(this.operator !== null) this.compute()
    this.previous = parseFloat(this.current)
    this.operator = operator
    this.shouldResetScreen = true
  }

  compute(){
    if(this.operator === null || this.previous === null) return

    const currentValue = parseFloat(this.current)
    let result

    switch(this.operator){
      case "+": result = this.previous + currentValue; break
      case "-": result = this.previous - currentValue; break
      case "*": result = this.previous * currentValue; break
      case "/": result = this.previous / currentValue; break
    }

    this.current = this.format(result)
    this.operator = null
    this.previous = null
    this.shouldResetScreen = true
    this.updateDisplay()
  }

  format(number){
    if(!isFinite(number)) return "Error"
    return parseFloat(number.toPrecision(12)).toString()
  }

  toggleSign(){
    this.current = (parseFloat(this.current) * -1).toString()
    this.updateDisplay()
  }

  percent(){
    this.current = (parseFloat(this.current) / 100).toString()
    this.updateDisplay()
  }
}

const calculator = new Calculator(document.getElementById("display"))
const buttons = document.getElementById("buttons")

buttons.addEventListener("click", e=>{
  const target = e.target
  if(!target.matches("button")) return

  if(target.dataset.number){
    calculator.appendNumber(target.dataset.number)
  }

  if(target.dataset.operator){
    calculator.chooseOperator(target.dataset.operator)
  }

  if(target.dataset.action){
    switch(target.dataset.action){
      case "clear": calculator.reset(); break
      case "sign": calculator.toggleSign(); break
      case "percent": calculator.percent(); break
      case "equals": calculator.compute(); break
    }
  }
})

/* Keyboard Support */
document.addEventListener("keydown", e=>{
  if(!isNaN(e.key) || e.key === ".") calculator.appendNumber(e.key)
  if(["+","-","*","/"].includes(e.key)) calculator.chooseOperator(e.key)
  if(e.key === "Enter") calculator.compute()
  if(e.key === "Backspace") calculator.reset()
})
</script>

</body>
</html>
